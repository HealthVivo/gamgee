language: cpp

env:
  global: 
    - secure: "gFJsmma5duxLv+bcn5Qvq6M9r3w0XZZ/GVlolSX3t3rlyqyGwEiN71F7+8Rtv+pzgUaMELKuA8JO+x6ZpOCnMCa/RB/TV6KJrZ31UPfV7BJjt6QzWWPMlkT+3i+pM3PUVoN1zTojz+SE9pMhyILeIx+23S/8mHGXmmIW1Es001I="

compiler: 
  - gcc
  - clang

before_install:
  - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
  - if [ "$CXX" == "clang++" ]; then sudo add-apt-repository -y ppa:h-rayflood/llvm; fi
  - sudo add-apt-repository -y ppa:boost-latest/ppa
  - sudo apt-get -qq update
  - git clone https://github.com/boostorg/build.git

install:
  - sudo apt-get install -qq g++-4.8
  - if [ "$CXX" == "g++" ]; then TOOLSET=gcc; fi
  - if [ "$CXX" == "g++" ]; then sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 50; fi
  - if [ "$CXX" == "clang++" ]; then TOOLSET=clang; fi
  - if [ "$CXX" == "clang++" ]; then sudo apt-get install --allow-unauthenticated -qq clang-3.4; fi
  - if [ "$CXX" == "clang++" ]; then sudo update-alternatives --install /usr/local/bin/clang++ clang++ /usr/bin/clang++-3.4 50; fi
  - sudo apt-get install -qq boost1.55 
  - cd build && ./bootstrap.sh && sudo ./b2 install && cd -

script:
  - b2 -a toolset=$TOOLSET test

after_success:
  - if [ "$CXX" == "g++" ] && [ "$TRAVIS_BRANCH" == "master" ]; then echo -e "Downloading latest Doxygen..." && wget https://github.com/doxygen/doxygen/archive/Release_1_8_7.tar.gz -O $HOME/doxygen-1.8.7.tgz && pushd $HOME && tar xzf doxygen-1.8.7.tgz && cd $HOME/doxygen-Release_1_8_7 && ./configure > /dev/null && make > /dev/null && sudo make install > /dev/null && popd && sudo rm -rf build && doxygen; fi
  - if [ "$CXX" == "g++" ] && [ "$TRAVIS_BRANCH" == "master" ]; then echo -e "Publishing doxygen...\n" && git config --global user.email "travis@travis-ci.org" && git config --global user.name "travis-ci" && git clone --branch=gh-pages https://${GH_TOKEN}@github.com/broadinstitute/gamgee gh-pages && cd gh-pages && rm -rf doxygen/ && mv ../dox/html doxygen/ && git add doxygen/ && git commit -am "Latest doxygen documentation on successful travis build $TRAVIS_BUILD_NUMBER auto-pushed" && git push origin gh-pages && echo -e "Published doxygen.\n"; fi
